<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>旅行公帳池系統 - Firebase 版</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { color: #333; }
  input, button { padding: 5px; margin: 3px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background-color: #f5f5f5; }
  #balance { font-size: 1.5em; color: green; margin: 10px 0; }
</style>
</head>
<body>

<h2>旅行公帳池系統</h2>

<!-- 新增收入 -->
<div>
  <h3>新增收入</h3>
  <input type="number" id="income" placeholder="金額">
  <button onclick="addIncome()">新增收入</button>
</div>

<!-- 顯示剩餘金額 -->
<div id="balance">剩餘金額：0 元</div>

<hr>

<!-- 新增花費 -->
<div>
  <h3>新增花費</h3>
  <input type="text" id="desc" placeholder="用途">
  <input type="number" id="amount" placeholder="金額">
  <button onclick="addExpense()">新增花費</button>
</div>

<!-- 紀錄表 -->
<table>
  <thead>
    <tr>
      <th>類型</th>
      <th>金額</th>
      <th>用途</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody id="recordsTable"></tbody>
</table>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyChzgS_IFOevrenqUL0oecU9BS-GZg0QvE",
    authDomain: "osaka-3ed9a.firebaseapp.com",
    databaseURL: "https://osaka-3ed9a-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "osaka-3ed9a",
    storageBucket: "osaka-3ed9a.firebasestorage.app",
    messagingSenderId: "217169641602",
    appId: "1:217169641602:web:86253f954ba5506e8f749b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const recordsRef = ref(db, 'records');

  function renderRecords(records) {
    let totalBalance = 0;
    let html = '';
    records.forEach(r => {
      if (r.type === 'income') totalBalance += r.amount;
      else totalBalance -= r.amount;

      html += `<tr>
        <td>${r.type === 'income' ? '收入' : '花費'}</td>
        <td>${r.amount}</td>
        <td>${r.desc}</td>
        <td><button onclick="deleteRecord('${r.id}')">刪除</button></td>
      </tr>`;
    });
    document.getElementById('recordsTable').innerHTML = html;
    document.getElementById('balance').innerText = `剩餘金額：${totalBalance.toFixed(2)} 元`;
  }

  // 即時監聽資料變化
  onValue(recordsRef, snapshot => {
    const data = snapshot.val() || {};
    const records = Object.keys(data).map(id => ({
      id,
      ...data[id]
    }));
    renderRecords(records);
  });

  window.addIncome = function() {
    let amount = parseFloat(document.getElementById('income').value);
    if (isNaN(amount) || amount <= 0) {
      alert('金額需大於 0');
      return;
    }
    push(recordsRef, { type: 'income', amount, desc: '公帳收入' });
    document.getElementById('income').value = '';
  };

  window.addExpense = function() {
    let amount = parseFloat(document.getElementById('amount').value);
    let desc = document.getElementById('desc').value.trim();
    if (!desc) {
      alert('請輸入用途');
      return;
    }
    if (isNaN(amount) || amount <= 0) {
      alert('金額需大於 0');
      return;
    }
    push(recordsRef, { type: 'expense', amount, desc });
    document.getElementById('amount').value = '';
    document.getElementById('desc').value = '';
  };

  window.deleteRecord = function(id) {
    if (!confirm('確定要刪除此紀錄嗎？')) return;
    remove(ref(db, 'records/' + id));
  };
</script>

</body>
</html>


